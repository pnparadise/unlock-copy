# Unlock Copy Paste - Chrome Extension

专注于解锁网站复制限制的Chrome扩展程序，Ctrl+C 复制功能进行了深度优化。

## 功能特性

- 🔓 **复制解锁**：绕过网站复制限制，支持 Ctrl+C 复制
- 🔄 **切换开关**：现代化开关设计，一键启用/禁用
- 🖱️ **右键菜单**：支持右键快速切换扩展状态
- 🌐 **域名管理**：基于域名的智能配置
- 🎯 **即时反馈**：复制成功提示和状态指示
- ✨ **文本选择**：自动启用被禁用的文本选择

## 核心技术

### 高级 Copy 事件拦截
```javascript
// 在捕获阶段拦截所有 copy 事件
document.addEventListener('copy', function(e) {
    e.stopImmediatePropagation(); // 阻止网站处理
    // 执行我们自己的复制逻辑
}, true);
```

### 智能域名检测
- 直接使用 `window.location.hostname` 获取完整域名
- 支持子域名精确匹配（如 `www.sina.com.cn`）
- 实时监控地址栏变化和标签页切换

### 多重复制保障
1. **Clipboard API**：现代浏览器的首选方法
2. **execCommand 备用**：兼容旧版浏览器
3. **Textarea 方法**：终极备用方案

## 安装方法

### 开发者模式安装

1. 下载或克隆此项目到本地
2. 打开Chrome浏览器，进入 `chrome://extensions/`
3. 开启右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择项目文件夹
6. 安装完成！

## 使用方法

### 基本使用
1. 安装后扩展根据域名配置自动启用
2. 在任何网站选中文本
3. 按 `Ctrl+C` 即可复制
4. 复制成功会显示绿色提示

### 控制方式

#### 1. 扩展弹窗
- **工具栏图标**：点击查看扩展状态和域名配置
- **切换开关**：现代化的滑动开关，绿色表示启用，红色表示禁用
- **状态指示**：
  - 绿色圆点 = 扩展已启用
  - 红色圆点 = 扩展已禁用
- **域名管理**：自动显示已配置的生效域名列表

#### 2. 右键菜单
- 在任意页面右键点击
- 选择 "Toggle Unlock Copy Paste" 快速切换状态
- 支持快捷键操作（如果在manifest中配置）

#### 3. 工具栏徽章
- 无徽章 = 扩展已启用
- 红色 "OFF" = 扩展已禁用

### 域名配置
- 启用扩展时自动添加当前域名到配置
- 禁用扩展时自动从配置中移除当前域名
- 支持通配符匹配（如 `*.example.com`）

## 界面预览

### 启用状态
```
🔓 解锁复制粘贴
● 扩展已激活        [●——○]

生效域名：
[www.sina.com.cn] [×]
[zhihu.com] [×]
```

### 禁用状态  
```
🔒 解锁复制粘贴
● 扩展已禁用        [○——●]

生效域名：
暂无配置域名
```

## 工作原理

### 1. Copy 事件拦截
- 在捕获阶段拦截所有 copy 事件
- 使用 `stopImmediatePropagation()` 阻止网站处理
- 立即执行我们的复制逻辑

### 2. 智能复制策略
```javascript
// 优先使用 Clipboard API
if (navigator.clipboard) {
    await navigator.clipboard.writeText(text);
} else {
    // 备用 execCommand 方法
    document.execCommand('copy');
}
```

### 3. 状态管理架构
- **Content Script**：维护扩展状态，处理域名检测
- **Background Script**：管理图标状态，处理标签页切换
- **双向通信**：Content Script 主动更新图标，Background Script 请求状态

### 4. 标签页同步
- 标签页切换时自动更新图标状态
- Background Script 向 Content Script 请求当前状态
- 确保图标始终反映当前标签页的扩展状态

## 文件结构

```
unlock-copy/
├── manifest.json          # 扩展配置文件
├── content.js            # 核心复制解锁逻辑
├── background.js         # 后台状态管理
├── popup.html           # 弹窗界面（中文）
├── popup.css            # 现代化样式（包含切换开关）
├── popup.js             # 界面交互逻辑
├── icons/               # 图标资源
│   ├── icon16.png       # 16x16 图标
│   ├── icon32.png       # 32x32 图标  
│   ├── icon48.png       # 48x48 图标
│   └── icon128.png      # 128x128 图标
└── README.md            # 项目文档
```

## 兼容性

- ✅ Chrome 88+
- ✅ Microsoft Edge 88+  
- ✅ 其他 Chromium 内核浏览器
- ✅ 支持所有主流网站

## 测试网站

以下网站已验证可正常工作：
- 语雀 (yuque.com)
- 知乎 (zhihu.com)
- CSDN (csdn.net)
- 简书 (jianshu.com)
- 各类文档网站

## 常见问题

### Q: 复制后没有提示怎么办？
A: 检查扩展是否启用，工具栏图标不应显示红色 "OFF" 徽章，或查看弹窗中的切换开关状态。

### Q: 某些网站仍无法复制？
A: 尝试刷新页面，或在扩展弹窗中重新启用扩展，确保当前域名已添加到配置中。

### Q: 如何确认复制成功？
A: 复制成功会在页面右上角显示绿色 "✅ 已复制 X 个字符" 提示。

### Q: 扩展会影响网站功能吗？
A: 不会。扩展只处理复制相关功能，不干扰网站其他操作。

### Q: 右键菜单在哪里？
A: 在任意网页上右键点击，菜单中会显示 "Toggle Unlock Copy Paste" 选项。

### Q: 切换标签页时图标状态不对？
A: 扩展会自动检测标签页切换并更新图标状态，如有问题请刷新页面。

## 隐私保护

- 🔒 **零数据收集**：不收集任何用户数据
- 🌐 **本地运行**：所有处理均在本地完成
- 🚫 **无网络请求**：不向任何服务器发送信息
- 📖 **开源透明**：代码完全开源，可自由审查

## 技术亮点

### 事件拦截技术
- 使用捕获阶段拦截，优先级最高
- `stopImmediatePropagation()` 彻底阻止网站处理
- 支持各种复杂的网站限制场景

### 域名智能管理
- 完整域名匹配，支持子域名
- 自动配置管理，无需手动设置
- 支持通配符模式匹配

### 用户体验优化
- Toast 提示提供即时反馈
- 现代化切换开关设计
- 状态徽章清晰显示工作状态
- 右键菜单快速操作

### 代码质量
- 防重复执行机制
- 完善的错误处理
- 详细的调试日志
- 模块化架构设计

## 更新日志

### v3.0.0 (最新)
- 🎯 **重大改进**：简化域名检测逻辑，使用完整hostname
- 🎨 **界面升级**：全新切换开关设计，替代传统按钮
- 🖱️ **新增功能**：右键菜单支持快速切换
- 🌐 **域名管理**：智能域名配置系统
- 🔄 **状态同步**：优化标签页切换时的图标更新
- 🛠️ **架构优化**：Content Script 和 Background Script 通信优化

### v2.1.0
- 🎯 **重大改进**：采用 copy 事件拦截技术，大幅提升成功率
- ✨ **新增功能**：复制成功 Toast 提示
- 🎨 **界面优化**：全新中文界面，开关按钮集成到状态栏
- 🔧 **技术优化**：移除无效的事件传播控制，专注核心功能
- 📱 **状态管理**：完善的徽章状态指示系统

### v2.0.0
- 🔄 **架构重构**：简化代码结构，专注 Ctrl+C 功能
- 🛡️ **增强拦截**：改进事件监听器拦截机制
- 🎯 **性能优化**：减少不必要的处理，提升响应速度

### v1.0.0
- 🎉 **初始版本**：基础快捷键解锁功能
- 🖥️ **用户界面**：提供基本的控制面板
- 🌐 **网站支持**：支持主流网站复制解锁

## 开发者

如需报告问题或提出建议：
- 📧 提交 GitHub Issue
- 💬 发送反馈邮件

---

**让复制变得自由！🚀**